<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Troubleshooting & Status SAP</title>
    <link rel="stylesheet" href="estilos.css">
    <style>
        /* Grid de Erros */
        .error-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .error-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
        }
        .error-card:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        .error-title {
            margin-top: 0;
            color: #b91c1c; /* Vermelho escuro */
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .error-code {
            font-size: 0.75rem;
            background: #fee2e2;
            color: #991b1b;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 10px;
            white-space: nowrap;
        }

        /* Tags de Categoria */
        .cat-tag {
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: 700;
            color: #64748b;
            margin-bottom: 8px;
            display: block;
        }

        .solution-box {
            background-color: #f8fafc;
            border-left: 4px solid var(--primary);
            padding: 12px;
            margin-top: auto; /* Empurra para o fundo do card */
            border-radius: 0 4px 4px 0;
            font-size: 0.9rem;
            color: #475569;
        }
    </style>
</head>
<body>

    <header>
        <div style="display: flex; align-items: center; gap: 10px;">
            <button class="btn-outline-light" id="menuToggle" style="padding: 8px; display: none;" onclick="toggleSidebar()">
                ‚ò∞
            </button>
            <div class="brand">FERRAMENTA <span>Troubleshooting</span></div>
        </div>
        <div class="header-actions">
             <a href="index.html" class="btn-back">üè† Voltar</a>
        </div>
    </header>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <div class="workspace">
        <aside id="mainSidebar">
            <div class="history-container">
                <div class="history-header"><span class="history-title">Vistos Recentemente</span><button class="btn-clear-history" onclick="clearHistory()">Limpar</button></div>
                <div id="history-list" class="history-list"></div>
            </div>
            
            <div class="tree-container">
                <div class="tree-label">Categorias</div>
                <div style="margin-left: 0;">
                    <a href="#status-codes" class="node-item active" onclick="scrollToSection('status-codes')"><strong>Status IDoc (WE02)</strong></a>
                    <a href="#mapping-errors" class="node-item" onclick="scrollToSection('mapping-errors')"><strong>Erros de Dados (Mapping)</strong></a>
                    <a href="#functional-errors" class="node-item" onclick="scrollToSection('functional-errors')"><strong>Erros Funcionais SAP</strong></a>
                    <a href="#connectivity" class="node-item" onclick="scrollToSection('connectivity')"><strong>Conectividade (HTTP/Net)</strong></a>
                </div>
            </div>
        </aside>

        <main id="mainContent" style="flex: 1; overflow-y: auto;">

            <style>
                @media (max-width: 768px) {
                    #menuToggle { display: block !important; }
                    main { padding: 15px !important; }
                    
                    /* Tabela em Cards */
                    table, thead, tbody, th, td, tr { display: block; }
                    thead tr { position: absolute; top: -9999px; left: -9999px; }
                    
                    tr { 
                        margin-bottom: 15px; 
                        border: 1px solid #e2e8f0; 
                        border-radius: 8px; 
                        padding: 15px; 
                        background: white; 
                        box-shadow: 0 2px 4px rgba(0,0,0,0.03); 
                    }
                    
                    td { 
                        border: none; 
                        position: relative; 
                        padding-left: 0; 
                        padding-bottom: 10px;
                    }
                    
                    /* Ajustes Grid */
                    .error-grid {
                        grid-template-columns: 1fr;
                        padding: 0;
                    }
                }
            </style>

            <div id="status-codes" style="margin-bottom: 50px;">
                <div class="card-header" style="border-radius: 8px; margin-bottom: 20px;">
                    <div class="card-title"><h2>C√≥digos de Status IDoc (Transa√ß√£o WE02/WE05)</h2></div>
                </div>

                <div class="table-wrapper card">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 8%">Cod</th>
                                <th style="width: 10%">Tipo</th>
                                <th style="width: 35%">Significado</th>
                                <th style="width: 47%">A√ß√£o Recomendada</th>
                            </tr>
                        </thead>
                        <tbody id="statusTableBody">
                            <tr>
                                <td><span class="status-badge status-success">53</span></td>
                                <td>Sucesso</td>
                                <td><strong>Documento lan√ßado</strong><br>O processo foi conclu√≠do com sucesso.</td>
                                <td>Nenhuma a√ß√£o necess√°ria.</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge status-error">51</span></td>
                                <td>Erro</td>
                                <td><strong>Doc. aplica√ß√£o n√£o lan√ßado</strong><br>Erro funcional (dados inv√°lidos para o neg√≥cio).</td>
                                <td>Verificar o log detalhado no status. Geralmente requer corre√ß√£o na origem e reenvio, ou corre√ß√£o manual na BD87.</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge status-warning">64</span></td>
                                <td>Aguardando</td>
                                <td><strong>Pronto para processamento</strong><br>O IDoc chegou, mas o JOB ainda n√£o rodou.</td>
                                <td>Aguardar o job <code>RBDAPP01</code> ou processar manualmente na <code>BD87</code>.</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge status-error">56</span></td>
                                <td>Config</td>
                                <td><strong>IDoc com estrutura incorreta</strong><br>Segmento faltando ou parceiro n√£o configurado.</td>
                                <td>Verificar transa√ß√£o <code>WE20</code> (Perfil de Parceiro) e se o payload XML cont√©m todos os segmentos obrigat√≥rios.</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge status-error">68</span></td>
                                <td>Falha</td>
                                <td><strong>Erro - sem processamento posterior</strong><br>IDoc marcado manualmente para n√£o ser processado.</td>
                                <td>Verificar auditoria (quem marcou?). Geralmente indica um IDoc duplicado que foi cancelado.</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge status-warning">69</span></td>
                                <td>Audit</td>
                                <td><strong>IDoc foi editado</strong><br>Os dados foram alterados manualmente.</td>
                                <td>Aten√ß√£o: Indica interven√ß√£o manual. Verificar integridade dos dados.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="mapping-errors" style="margin-bottom: 50px;">
                <div class="card-header" style="border-radius: 8px; margin-bottom: 20px;">
                    <div class="card-title"><h2>Erros de Dados e Mapeamento</h2></div>
                </div>

                <div class="error-grid">
                    
                    <div class="error-card">
                        <span class="cat-tag">Formato</span>
                        <h3 class="error-title">Data Inv√°lida (dd.mm.yyyy) <span class="error-code">Date Format</span></h3>
                        <p><strong>Sintoma:</strong> IDoc quebra ou data entra como 00.00.0000.</p>
                        <p><strong>Causa:</strong> O SAP espera <code>YYYYMMDD</code> puro. Formatos com barras (/) ou pontos (.) falham.</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Use a fun√ß√£o <strong>FORMAT DATE</strong>. Converta <code>31/12/2025</code> para <code>20251231</code>.
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Formato</span>
                        <h3 class="error-title">Objeto n√£o encontrado (Zeros) <span class="error-code">Leading Zeros</span></h3>
                        <p><strong>Sintoma:</strong> Erro "Cliente 123 n√£o existe", mas o cliente existe.</p>
                        <p><strong>Causa:</strong> Campos num√©ricos (KUNNR, MATNR, LIFNR) exigem zeros √† esquerda.</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Use a fun√ß√£o <strong>LPAD</strong>. Preencha com '0' at√© o tamanho total (ex: 10).<br>
                            <code>123</code> -> <code>0000000123</code>.
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Num√©rico</span>
                        <h3 class="error-title">Erro de Valor/Montante <span class="error-code">Decimal Format</span></h3>
                        <p><strong>Sintoma:</strong> Valor 100,00 entra como 10000 ou erro de convers√£o.</p>
                        <p><strong>Causa:</strong> O SAP (via IDoc) espera ponto <code>.</code> como decimal e <strong>nenhum</strong> separador de milhar.</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Use <strong>TRANSLATE</strong> ou Replace.<br>
                            Errado: <code>1.234,56</code> | Certo: <code>1234.56</code>.
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Valida√ß√£o</span>
                        <h3 class="error-title">Estouro de Campo <span class="error-code">Length Exceeded</span></h3>
                        <p><strong>Sintoma:</strong> Erro t√©cnico "Value is too long for field X".</p>
                        <p><strong>Causa:</strong> Enviar 40 caracteres num campo CHAR(35) (ex: Endere√ßo, Nome).</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Use a fun√ß√£o <strong>SUBSTRING</strong> para cortar o excesso ou divida o valor em dois campos (ex: <code>STRAS</code> e <code>ORT02</code>).
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Dom√≠nio</span>
                        <h3 class="error-title">Unidade n√£o prevista <span class="error-code">ISO Code</span></h3>
                        <p><strong>Sintoma:</strong> Erro "Unidade PC n√£o existe".</p>
                        <p><strong>Causa:</strong> O IDoc espera o c√≥digo ISO (Tabela T006) e n√£o o comercial.</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Fa√ßa um De/Para.<br>
                            Pe√ßa -> <strong>PCE</strong> (ISO) ou <strong>ST</strong> (SAP Internal).<br>
                            Caixa -> <strong>CX</strong> ou <strong>BX</strong>.
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Encoding</span>
                        <h3 class="error-title">Caracteres Inv√°lidos (XML) <span class="error-code">Parsing Error</span></h3>
                        <p><strong>Sintoma:</strong> O fluxo falha antes de entrar no SAP (Erro de Parse XML).</p>
                        <p><strong>Causa:</strong> Caracteres como <code>&</code>, <code><</code>, <code>></code> no meio do texto quebram o XML.</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Escape os caracteres na origem.<br>
                            <code>&</code> vira <code>&amp;amp;</code><br>
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Regional</span>
                        <h3 class="error-title">Incompatibilidade Regi√£o/Pa√≠s <span class="error-code">Region Check</span></h3>
                        <p><strong>Sintoma:</strong> Erro "Regi√£o SP n√£o definida para o pa√≠s US".</p>
                        <p><strong>Causa:</strong> Tentar enviar um estado (UF) que n√£o pertence ao pa√≠s informado (Tabela T005S).</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Valide a combina√ß√£o Pa√≠s/UF antes do envio. SP √© BR, CA √© US (California).
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Bloqueio</span>
                        <h3 class="error-title">Objeto Bloqueado <span class="error-code">Lock Entry</span></h3>
                        <p><strong>Sintoma:</strong> Erro "O objeto est√° sendo processado pelo usu√°rio X".</p>
                        <p><strong>Causa:</strong> Algu√©m est√° com o cadastro aberto na tela (GUI) enquanto o IDoc tenta salvar.</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            N√£o √© erro de dados. Reprocessar o IDoc (BD87) ap√≥s alguns minutos.
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Fiscal</span>
                        <h3 class="error-title">CNPJ/CPF Inv√°lido <span class="error-code">Tax Number</span></h3>
                        <p><strong>Sintoma:</strong> Erro de valida√ß√£o "D√≠gito verificador inv√°lido".</p>
                        <p><strong>Causa:</strong> O SAP valida matematicamente os documentos fiscais brasileiros (STCD1/STCD2).</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Saneamento de dados. N√£o √© poss√≠vel integrar documentos fict√≠cios ou errados em ambiente produtivo.
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Estrutura</span>
                        <h3 class="error-title">Segmento Obrigat√≥rio Faltando <span class="error-code">Mandatory Seg</span></h3>
                        <p><strong>Sintoma:</strong> Status 26 ou erro de sintaxe "Segmento E1MARAM obrigat√≥rio".</p>
                        <p><strong>Causa:</strong> O IDoc foi montado sem um segmento pai/filho exigido pela hierarquia.</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Revisar a estrutura do JSON/XML gerado. Campos chave como <code>MATNR</code> exigem seus segmentos container.
                        </div>
                    </div>

                </div>
            </div>

            <div id="functional-errors" style="margin-bottom: 50px;">
                <div class="card-header" style="border-radius: 8px; margin-bottom: 20px;">
                    <div class="card-title"><h2>Erros Funcionais (Regra de Neg√≥cio)</h2></div>
                </div>

                <div class="error-grid">
                    
                    <div class="error-card">
                        <span class="cat-tag">Mestre de Materiais</span>
                        <h3 class="error-title">Material n√£o ampliado <span class="error-code">M3 351</span></h3>
                        <p><strong>Erro:</strong> "O material n√£o est√° criado no centro XXXX".</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            O material existe (MARA), mas falta a vis√£o de Centro (MARC). √â necess√°rio criar a vis√£o de centro antes de fazer movimentos ou pedidos.
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Financeiro</span>
                        <h3 class="error-title">Per√≠odo Cont√°bil Fechado <span class="error-code">F5 201</span></h3>
                        <p><strong>Erro:</strong> "Per√≠odo 01/2024 n√£o est√° aberto para conta X".</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            O m√™s cont√°bil virou. Solicitar √† contabilidade a abertura do per√≠odo na transa√ß√£o <strong>MMPV</strong> ou <strong>OB52</strong>.
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Vendas</span>
                        <h3 class="error-title">Organiza√ß√£o de Vendas <span class="error-code">V1 306</span></h3>
                        <p><strong>Erro:</strong> "Cliente X n√£o est√° ampliado para a √°rea de vendas Y/Z".</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Verifique os campos <code>VKORG</code> (Org Vendas), <code>VTWEG</code> (Canal) e <code>SPART</code> (Setor). O cliente precisa ser estendido para essa combina√ß√£o (KNVV).
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Compras</span>
                        <h3 class="error-title">Fornecedor Bloqueado <span class="error-code">M8 088</span></h3>
                        <p><strong>Erro:</strong> "Fornecedor bloqueado para a organiza√ß√£o de compras".</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Verificar campo <code>SPERM</code> (Bloqueio compras) no mestre. Se for intencional, n√£o √© poss√≠vel integrar pedidos.
                        </div>
                    </div>

                </div>
            </div>

            <div id="connectivity" style="margin-bottom: 50px;">
                <div class="card-header" style="border-radius: 8px; margin-bottom: 20px;">
                    <div class="card-title"><h2>Erros de Conectividade (HTTP)</h2></div>
                </div>

                <div class="error-grid">
                    
                    <div class="error-card">
                        <span class="cat-tag">Autentica√ß√£o</span>
                        <h3 class="error-title">N√£o Autorizado <span class="error-code">401 Unauthorized</span></h3>
                        <p><strong>Causa:</strong> Usu√°rio ou senha incorretos na chamada do servi√ßo.</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Verificar credenciais do usu√°rio de servi√ßo (ex: <code>INTEG_USER</code>). Verificar se a senha expirou na <code>SU01</code>.
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Permiss√£o</span>
                        <h3 class="error-title">Proibido <span class="error-code">403 Forbidden</span></h3>
                        <p><strong>Causa:</strong> O usu√°rio logou, mas n√£o tem permiss√£o para este servi√ßo espec√≠fico.</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Verificar roles (PFCG) do usu√°rio. Falta objeto de autoriza√ß√£o para o servi√ßo SICF ou para o objeto de neg√≥cio.
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Servidor</span>
                        <h3 class="error-title">Erro Interno <span class="error-code">500 Internal Error</span></h3>
                        <p><strong>Causa:</strong> Crash no programa ABAP (Dump) durante o processamento.</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Verificar a transa√ß√£o <strong>ST22</strong> (ABAP Dumps) no SAP para ver o erro t√©cnico detalhado (ex: Time Out, Memory Low).
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Rede</span>
                        <h3 class="error-title">Connection Timed Out <span class="error-code">Timeout</span></h3>
                        <p><strong>Causa:</strong> Firewall bloqueando ou sistema destino offline.</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Verificar se o IP de origem est√° liberado no Firewall/Cloud Connector. Testar conectividade b√°sica (Ping/Telnet).
                        </div>
                    </div>

                    <div class="error-card">
                        <span class="cat-tag">Configura√ß√£o PI/PO/CPI</span>
                        <h3 class="error-title">Erro Business System SLD <span class="error-code">LCR_GET_OWN_BUSINESS_SYSTEM</span></h3>
                        <p><strong>Erro:</strong> "Erro ao ler o ID de um business system pr√≥prio do SLD...". Comum em cen√°rios PI/PO e <strong>CPI</strong> (via Cloud Connector).</p>
                        <div class="solution-box">
                            <span class="solution-title">Solu√ß√£o</span>
                            Acesse a transa√ß√£o <strong>SXMB_ADM</strong> &rarr; Integration Engine Configuration (ou use <strong>SXMB_APPL</strong>). Configure a categoria "Role of Business System" corretamente.
                        </div>
                    </div>

                </div>
            </div>

        </main>
    </div>

    <script>
        function toggleSidebar() {
            document.getElementById('mainSidebar').classList.toggle('open');
            document.getElementById('sidebarOverlay').classList.toggle('open');
        }

        // --- BUSCA INTELIGENTE ---
        // (O c√≥digo de busca que j√° existe aqui)

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
            
            // Fecha sidebar no mobile
            if (window.innerWidth <= 768) {
                toggleSidebar();
            }
        }

        // --- HIST√ìRICO DE NAVEGA√á√ÉO ---
        (function() {
            const MAX_HISTORY = 10;
            const HISTORY_KEY = 'sap_docs_history';
            if (!window.location.pathname.endsWith('index.html')) {
                const pageTitle = document.title.split('-')[0].trim();
                const currentPage = { title: pageTitle, url: window.location.pathname.split('/').pop() };
                let history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
                history = history.filter(h => h.url !== currentPage.url);
                history.unshift(currentPage);
                if (history.length > MAX_HISTORY) history.pop();
                localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
            }
            const container = document.getElementById('history-list');
            if (container) {
                const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
                if (history.length === 0) container.innerHTML = '<div style="padding:5px 12px; font-size:0.75rem; color:#64748b;">Nenhum item recente.</div>';
                else { container.innerHTML = history.map(h => `<a href="${h.url}" class="history-link">${h.title}</a>`).join(''); }
            }
            window.clearHistory = function() { localStorage.removeItem(HISTORY_KEY); if(document.getElementById('history-list')) document.getElementById('history-list').innerHTML = ''; }
        })();
    </script>
</body>
</html>