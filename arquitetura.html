<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cen√°rios de Arquitetura 4MDG</title>
    <link rel="stylesheet" href="estilos.css">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'neutral', securityLevel: 'loose' });
    </script>
    <style>
        .diagram-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f1f5f9;
        }
        .diagram-title { font-size: 1.1rem; color: #1e293b; font-weight: 700; margin: 0; }
        .diagram-desc { font-size: 0.9rem; color: #64748b; margin-bottom: 20px; line-height: 1.6; }
        .mermaid { display: flex; justify-content: center; margin: 20px 0; }
    </style>
</head>
<body>

    <header>
        <div style="display: flex; align-items: center; gap: 10px;">
            <button class="btn-outline-light" id="menuToggle" style="padding: 8px; display: none;" onclick="toggleSidebar()">
                ‚ò∞
            </button>
            <div class="brand">FERRAMENTA <span>Arquitetura</span></div>
        </div>
        <div class="header-actions">
             <a href="index.html" class="btn-back">üè† Voltar</a>
        </div>
    </header>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <div class="workspace">
        <aside id="mainSidebar">
            <div class="history-container">
                <div class="history-header"><span class="history-title">Vistos Recentemente</span><button class="btn-clear-history" onclick="clearHistory()">Limpar</button></div>
                <div id="history-list" class="history-list"></div>
            </div>
            <div class="tree-container">
                <div class="tree-label">Cen√°rios</div>
                <div style="margin-left: 0;">
                    <a href="#scenario-cpi" class="node-item active" onclick="scrollToSection('scenario-cpi')"><strong>1. Via SAP CPI (Cloud)</strong></a>
                    <a href="#scenario-pi" class="node-item" onclick="scrollToSection('scenario-pi')"><strong>2. Via SAP PI/PO (OnPrem)</strong></a>
                    <a href="#scenario-outbound" class="node-item" onclick="scrollToSection('scenario-outbound')"><strong>3. SAP chamando 4MDG</strong></a>
                </div>
            </div>
        </aside>

        <main id="mainContent">

            <div id="scenario-cpi" class="card">
                <div class="diagram-header">
                    <h2 class="diagram-title">1. Integra√ß√£o via SAP CPI (Cloud Integration)</h2>
                    <span class="badge badge-info">JSON Nativo</span>
                </div>
                <p class="diagram-desc">
                    Neste fluxo moderno, os dados trafegam inteiramente em <strong>JSON</strong>. O portal envia para o Gateway do cliente, que repassa ao SAP CPI. O CPI orquestra a entrega no SAP S/4HANA ou ECC e retorna a confirma√ß√£o (Devolu√ß√£o) pelo mesmo caminho.
                </p>
                
                <div class="table-wrapper">
                    <div class="mermaid">
                    sequenceDiagram
                        participant Portal as Portal
                        participant GW as Gateway
                        participant CPI as SAP CPI
                        participant SAP as SAP Backend

                        Note over Portal, SAP: Fluxo JSON (Sem convers√£o XML)

                        Portal->>GW: Envia Dados (JSON)
                        GW->>CPI: Repassa (JSON)
                        CPI->>SAP: Integra√ß√£o (JSON/OData/RFC)
                        
                        activate SAP
                        SAP->>SAP: Processa Dados
                        SAP-->>CPI: Retorno/Devolu√ß√£o (JSON)
                        deactivate SAP
                        
                        CPI-->>GW: Response
                        GW-->>Portal: Confirma√ß√£o Final
                    </div>
                </div>
            </div>

            <div id="scenario-pi" class="card">
                <div class="diagram-header">
                    <h2 class="diagram-title">2. Integra√ß√£o via SAP PI/PO (Process Orchestration)</h2>
                    <span class="badge badge-warning">Convers√£o XML</span>
                </div>
                <p class="diagram-desc">
                    No fluxo legado/on-premise, ocorre a <strong>transforma√ß√£o de formato</strong>. O Portal envia JSON, mas o SAP PI/PO converte para <strong>XML (IDoc)</strong> antes de entregar ao SAP.
                </p>

                <div class="table-wrapper">
                    <div class="mermaid">
                    sequenceDiagram
                        participant Portal as Portal
                        participant GW as Gateway
                        participant PI as SAP PI/PO
                        participant SAP as SAP Backend

                        Portal->>GW: Envia Dados (JSON)
                        GW->>PI: Repassa (JSON)
                        
                        Note right of PI: Convers√£o: JSON -> XML
                        
                        PI->>SAP: Envia IDoc (XML)
                        
                        activate SAP
                        SAP->>SAP: Processa IDoc
                        SAP-->>PI: Status 53/51 (XML)
                        deactivate SAP
                        
                        Note right of PI: Convers√£o: XML -> JSON
                        
                        PI-->>GW: Response (JSON)
                        GW-->>Portal: Devolu√ß√£o/Status
                    </div>
                </div>
            </div>

            <div id="scenario-outbound" class="card">
                <div class="diagram-header">
                    <h2 class="diagram-title">3. SAP Chamando Portal (Outbound)</h2>
                    <span class="badge badge-danger">SAP Ativo</span>
                </div>
                <p class="diagram-desc">
                    Cen√°rio onde o SAP inicia a comunica√ß√£o (ex: envio de notas fiscais, atualiza√ß√£o de status). O tr√°fego √© <strong>JSON</strong> direto, passando pelo Gateway at√© chegar ao Portal, que devolve o recebimento.
                </p>

                <div class="table-wrapper">
                    <div class="mermaid">
                    sequenceDiagram
                        participant SAP as SAP Backend
                        participant GW as Gateway
                        participant Portal as Portal

                        Note over SAP, Portal: Fluxo JSON

                        SAP->>GW: Chamada HTTP POST (JSON)
                        GW->>Portal: Entrega Dados (JSON)
                        
                        activate Portal
                        Portal->>Portal: Processa/Atualiza
                        Portal-->>GW: Devolu√ß√£o (OK/Erro)
                        deactivate Portal
                        
                        GW-->>SAP: Retorno ao SAP
                    </div>
                </div>
            </div>

        </main>
    </div>

    <style>
        @media (max-width: 768px) {
            #menuToggle { display: block !important; }
            main { padding: 15px !important; }
            .card { padding: 15px !important; }
            .diagram-header { flex-direction: column; align-items: flex-start; gap: 10px; }
        }
    </style>

    <script>
        function toggleSidebar() {
            document.getElementById('mainSidebar').classList.toggle('open');
            document.getElementById('sidebarOverlay').classList.toggle('open');
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
            document.querySelectorAll('.node-item').forEach(el => el.classList.remove('active'));
            
            // Se for mobile, fecha a sidebar ao clicar
            if (window.innerWidth <= 768) {
                toggleSidebar();
            }
            
            // Tenta achar o link que foi clicado para ativar (se n√£o for via evento direto)
            const activeNode = Array.from(document.querySelectorAll('.node-item')).find(el => el.getAttribute('onclick')?.includes(id));
            if(activeNode) activeNode.classList.add('active');
        }

        // --- HIST√ìRICO ---
        (function() {
            const MAX_HISTORY = 10;
            const HISTORY_KEY = 'sap_docs_history';
            if (!window.location.pathname.endsWith('index.html')) {
                const standardizedTitle = document.title;
                const currentPage = { title: standardizedTitle, url: window.location.pathname.split('/').pop() };
                let history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
                history = history.filter(h => h.url !== currentPage.url);
                history.unshift(currentPage);
                if (history.length > MAX_HISTORY) history.pop();
                localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
            }
            const container = document.getElementById('history-list');
            if (container) {
                const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
                if (history.length === 0) container.innerHTML = '<div style="padding:5px 8px; font-size:0.75rem; color:#64748b;">Nenhum item recente.</div>';
                else { container.innerHTML = history.map(h => `<a href="${h.url}" class="history-link">${h.title}</a>`).join(''); }
            }
            window.clearHistory = function() { localStorage.removeItem(HISTORY_KEY); if(document.getElementById('history-list')) document.getElementById('history-list').innerHTML = ''; }
        })();
    </script>
</body>
</html>